# 部署配置

## 服务器环境
- 操作系统：CentOS 7
- Web 服务器：Nginx
- SSL 证书：自签名证书

## 部署步骤
1. **环境准备**
   ```bash
   # 安装 Node.js
   curl -sL https://rpm.nodesource.com/setup_14.x | bash -
   yum install -y nodejs

   # 安装 Nginx
   yum install -y nginx

   # 安装 certbot
   yum install -y epel-release
   yum install -y certbot
   ```

2. **项目构建**
   ```bash
   # 安装依赖
   npm install

   # 构建项目
   npm run build
   ```

3. **文件部署**
   ```bash
   # 上传构建文件
   scp -i ~/.ssh/xfweb -r dist/* root@1.95.60.219:/usr/server/XFWeb/dist/
   ```

4. **Nginx 配置**
   - 配置文件位置：`/etc/nginx/conf.d/xfweb.conf`
   - 配置内容：
     ```nginx
     server {
         listen 80;
         server_name 1.95.60.219;
         return 301 https://1.95.60.219$request_uri;
     }

     server {
         listen 443 ssl;
         server_name 1.95.60.219;

         ssl_certificate /etc/nginx/ssl/nginx.crt;
         ssl_certificate_key /etc/nginx/ssl/nginx.key;
         ssl_protocols TLSv1.2 TLSv1.3;
         ssl_ciphers HIGH:!aNULL:!MD5;

         root /usr/server/XFWeb/dist;
         index index.html;

         location / {
             try_files $uri $uri/ /index.html;
         }

         location /api/spark {
             proxy_pass https://spark-api-open.xf-yun.com/v2;
             proxy_set_header Host spark-api-open.xf-yun.com;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Forwarded-Proto $scheme;
         }
     }
     ```

5. **SSL 证书配置**
   ```bash
   # 创建证书目录
   mkdir -p /etc/nginx/ssl

   # 生成证书
   openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
     -keyout /etc/nginx/ssl/nginx.key \
     -out /etc/nginx/ssl/nginx.crt
   ```

6. **服务启动**
   ```bash
   # 启动 Nginx
   systemctl start nginx
   systemctl enable nginx
   ```

## 维护说明
1. **日志查看**
   ```bash
   # Nginx 访问日志
   tail -f /var/log/nginx/access.log

   # Nginx 错误日志
   tail -f /var/log/nginx/error.log
   ```

2. **服务重启**
   ```bash
   # 重启 Nginx
   systemctl restart nginx
   ```

3. **配置检查**
   ```bash
   # 检查 Nginx 配置
   nginx -t
   ```

## 注意事项
1. 确保服务器防火墙开放 80 和 443 端口
2. 定期检查 SSL 证书有效期
3. 监控服务器资源使用情况
4. 定期备份重要数据
5. 保持系统和软件包更新 